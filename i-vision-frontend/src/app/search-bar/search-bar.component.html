<mat-accordion multi hideToggle>

    <div class="search-container {{isExpanded ? 'rounded-t-lg' :'rounded-lg'}}">

        <button class="btn search-btn" (click)="searchImage()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
        </button>

        <select class="py-2 w-5 sm:w-50" #cat [value]="category" (change)="onSelectionChange(cat.value)">
            <option value="" disabled selected>--Select Category--</option>
            @for (cetagory of cetagories; track $index) {
            <option value="{{cetagory}}">{{cetagory | titlecase }}</option>
            }
        </select>

        @if (currentObject) {
        <img class="object-cover mx-4 hover:cursor-pointer rounded-sm w-15 h-9" (click)="isExpanded=!isExpanded"
            width="40" height="40" src='data:image/png;base64,{{currentObject}}' />
        }

        <div class="input-wrapper">
            <form #search="ngForm" (ngSubmit)="searchImage()">
                <input type="text" class="search-input  placeholder:text-gray-500" #searchText name="searchText" [(ngModel)]="text"
                    placeholder="Search images or enter text...">
                <input hidden type="file" #uplode (change)="setImage($event)">
            </form>
        </div>

        @if (currentObject || text) {
            <div class="actions">
                <button class="btn image-btn" id="imageSearchBtn" (click)="currentObject=''; text=''">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-red-700">
                        <circle cx="12" cy="12" r="10" />
                        <path d="m15 9-6 6" />
                        <path d="m9 9 6 6" />
                    </svg>
                </button>
            </div>
        }

        <div class="actions">
            <button class="btn image-btn" id="imageSearchBtn" (click)="uplode.click()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-image-plus">
                    <path d="M16 5h6" />
                    <path d="M19 2v6" />
                    <path d="M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5" />
                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
                    <circle cx="9" cy="9" r="2" />
                </svg>
            </button>
        </div>
    </div>

    <mat-expansion-panel disabled [expanded]="isExpanded">

        <!-- ======================================================= detected object =================================================== -->

        @if (searchImgURL) {
        <div class="flex flex-col md:flex-row justify-between w-[70%] mx-auto">
            <div class="w-full md:w-2/3">
                <div class="relative w-full max-h-[500px] flex overflow-hidden">
                    <img [src]="searchImgURL" #searchImg (load)="onImageLoad(searchImg)" alt="Detection scene"
                        class="max-w-full rounded-lg max-h-[500px] object-contain" />

                    <!-- Object Markers -->
                    @for (item of items; track $index) {
                    <div class="object-marker {{currentObject == item?.object ? 'border-white' : 'border-red-500/100'}}"
                        [style]="'top:' + item.scaledBox[1] + 'px; left:' + item.scaledBox[0] + 'px; width:' + item.scaledBox[2] + 'px; height:' + item.scaledBox[3] + 'px;'"
                        [attr.data-label]="item.identity">
                    </div>
                    }

                </div>
            </div>

            <div class="w-full md:w-1/3">
                <div class="bg-gray-50 rounded-lg p-4 overflow-y-auto">
                    <div class="w-full gap-4 flex-col flex items-center">
                        <h2 class="text-xl font-medium text-gray-900 mb-4">
                            Detected Objects
                        </h2>

                        @for (item of items; track $index) {
                        <div class="bg-black w-30 h-30 flex justify-center hover:cursor-pointer items-center border-1 {{currentObject == item?.object ? 'border-white' : 'border-red-500/100'}} rounded-lg shadow-sm transition-all detection-thumbnail"
                            (mouseover)="changeBorderOnHover()"
                            (click)="currentObject = item?.object; isExpanded=false">
                            <div class="flex">
                                <div class="w-full h-full flex flex-col items-center ounded-md overflow-hidden">
                                    <img src="data:image/png;base64,{{item?.object}}"
                                        class="w-20 h-20 object-contain" />
                                    <h4 class="flex justify-center font-medium text-sm text-white">
                                        {{item?.identity | titlecase}}
                                    </h4>
                                </div>
                            </div>
                        </div>
                        }

                    </div>
                </div>
            </div>
        </div>
        }
    </mat-expansion-panel>

    @if (isClicked) {
    <app-detail-card [mockImages]="mockImages" [headerValue]="headerValue"></app-detail-card>
    }

    <button (click)="openDialog()"
        class="fab-button fixed bottom-6 right-6 w-14 h-14 rounded-lg text-white flex items-center justify-center shadow-lg !rounded-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-plus-icon lucide-plus">
            <path d="M5 12h14" />
            <path d="M12 5v14" />
        </svg>
    </button>